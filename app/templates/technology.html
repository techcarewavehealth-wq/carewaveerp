{% extends "base.html" %}
{% block content %}

<h1 style="display:flex; align-items:center; justify-content:space-between;">
  <span>Departamento Tecnol칩gico</span>
  <!-- Bot칩n de imprimir solo si haces clic aqu칤 -->
  <button type="button"
          onclick="window.print()"
          style="font-size:0.9rem; padding:0.25rem 0.6rem;">
    游둳 Imprimir
  </button>
</h1>

<p>Aqu칤 gestionas Administraci칩n de sistemas, Soporte, Desarrollo, Seguridad e Innovaci칩n.</p>

<p style="margin-top:0.5rem;">
  <strong>KPIs r치pidos:</strong>
  Tickets abiertos: <strong>{{ open_tickets }}</strong> |
  Incidentes abiertos: <strong>{{ open_incidents }}</strong> |
  Proyectos activos: <strong>{{ active_projects }}</strong>
</p>

<!-- ================== Administraci칩n de sistemas ================== -->
<section style="margin-top:1.5rem;">
  <h2>Administraci칩n de sistemas</h2>
  <form method="post" action="/technology/systems/create">
    <div>
      <label>Nombre del sistema</label>
      <input type="text" name="name" placeholder="Servidor producci칩n" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Categor칤a</label>
      <input type="text" name="category" placeholder="Servidor, red, base de datos, VPN..." required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Estado</label>
      <select name="status">
        <option value="operativo">Operativo</option>
        <option value="degradado">Degradado</option>
        <option value="ca칤do">Ca칤do</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Criticidad</label>
      <select name="criticality">
        <option value="baja">Baja</option>
        <option value="media" selected>Media</option>
        <option value="alta">Alta</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Responsable</label>
      <input type="text" name="owner" placeholder="Admin sistemas / proveedor">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Notas</label>
      <input type="text" name="notes">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Registrar sistema</button>
  </form>

  <h3 style="margin-top:1rem;">Sistemas registrados</h3>
  <table>
    <tr>
      <th>Nombre</th>
      <th>Categor칤a</th>
      <th>Estado</th>
      <th>Criticidad</th>
      <th>Responsable</th>
      <th>Notas</th>
      <th>Acciones</th>
    </tr>
    {% for s in systems %}
      <tr>
        <td>{{ s.name }}</td>
        <td>{{ s.category }}</td>
        <td>{{ s.status }}</td>
        <td>{{ s.criticality }}</td>
        <td>{{ s.owner or '' }}</td>
        <td>{{ s.notes or '' }}</td>
        <td>
          <form method="post"
                action="/technology/systems/{{ s.id }}/delete"
                onsubmit="return confirm('쮼liminar este sistema?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not systems %}
      <tr><td colspan="7">Todav칤a no hay sistemas registrados.</td></tr>
    {% endif %}
  </table>
</section>

<!-- ================== Soporte T칠cnico ================== -->
<section style="margin-top:1.5rem;">
  <h2>Soporte t칠cnico</h2>
  <form method="post" action="/technology/tickets/create">
    <div>
      <label>T칤tulo del ticket</label>
      <input type="text" name="title" placeholder="No puedo acceder al correo" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Descripci칩n</label>
      <input type="text" name="description">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Prioridad</label>
      <select name="priority">
        <option value="baja">Baja</option>
        <option value="media" selected>Media</option>
        <option value="alta">Alta</option>
        <option value="cr칤tica">Cr칤tica</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Categor칤a</label>
      <input type="text" name="category" placeholder="Hardware, software, acceso...">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Asignado a</label>
      <input type="text" name="assigned_to" placeholder="T칠cnico / equipo">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Crear ticket</button>
  </form>

  <h3 style="margin-top:1rem;">Tickets</h3>
  <table>
    <tr>
      <th>ID</th>
      <th>T칤tulo</th>
      <th>Estado</th>
      <th>Prioridad</th>
      <th>Categor칤a</th>
      <th>Solicitante</th>
      <th>Asignado a</th>
      <th>Creado</th>
      <th>Acciones</th>
    </tr>
    {% for t in tickets %}
      <tr>
        <td>{{ t.id }}</td>
        <td>{{ t.title }}</td>
        <td>{{ t.status }}</td>
        <td>{{ t.priority }}</td>
        <td>{{ t.category or '' }}</td>
        <td>{{ t.requester }}</td>
        <td>{{ t.assigned_to or '' }}</td>
        <td>{{ t.created_at }}</td>
        <td>
          <form method="post" action="/technology/tickets/{{ t.id }}/change_status" style="display:inline;">
            <select name="new_status">
              <option value="abierto" {% if t.status == 'abierto' %}selected{% endif %}>Abierto</option>
              <option value="en progreso" {% if t.status == 'en progreso' %}selected{% endif %}>En progreso</option>
              <option value="resuelto" {% if t.status == 'resuelto' %}selected{% endif %}>Resuelto</option>
              <option value="cerrado" {% if t.status == 'cerrado' %}selected{% endif %}>Cerrado</option>
            </select>
            <button type="submit">Cambiar</button>
          </form>
          <form method="post"
                action="/technology/tickets/{{ t.id }}/delete"
                style="display:inline;"
                onsubmit="return confirm('쮼liminar este ticket?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not tickets %}
      <tr><td colspan="9">No hay tickets de soporte.</td></tr>
    {% endif %}
  </table>
</section>

<!-- ================== Desarrollo de software ================== -->
<section style="margin-top:1.5rem;">
  <h2>Desarrollo de software</h2>
  <form method="post" action="/technology/projects/create">
    <div>
      <label>Nombre del proyecto</label>
      <input type="text" name="name" placeholder="Plataforma CareWave v2" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Descripci칩n</label>
      <input type="text" name="description">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Estado</label>
      <select name="status">
        <option value="en dise침o">En dise침o</option>
        <option value="en desarrollo">En desarrollo</option>
        <option value="en prueba">En prueba</option>
        <option value="en producci칩n">En producci칩n</option>
        <option value="cerrado">Cerrado</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Repositorio (URL)</label>
      <input type="text" name="repo_url" placeholder="https://github.com/...">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Owner / Responsable</label>
      <input type="text" name="owner">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Fecha inicio</label>
      <input type="date" name="start_date_str">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Fecha objetivo</label>
      <input type="date" name="due_date_str">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Crear proyecto</button>
  </form>

  <h3 style="margin-top:1rem;">Proyectos</h3>
  <table>
    <tr>
      <th>Nombre</th>
      <th>Estado</th>
      <th>Owner</th>
      <th>Repositorio</th>
      <th>Inicio</th>
      <th>Objetivo</th>
      <th>Acciones</th>
    </tr>
    {% for p in projects %}
      <tr>
        <td>{{ p.name }}</td>
        <td>{{ p.status }}</td>
        <td>{{ p.owner or '' }}</td>
        <td>{{ p.repo_url or '' }}</td>
        <td>{{ p.start_date or '' }}</td>
        <td>{{ p.due_date or '' }}</td>
        <td>
          <form method="post"
                action="/technology/projects/{{ p.id }}/delete"
                onsubmit="return confirm('쮼liminar este proyecto?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not projects %}
      <tr><td colspan="7">No hay proyectos registrados.</td></tr>
    {% endif %}
  </table>
</section>

<!-- ================== Seguridad inform치tica ================== -->
<section style="margin-top:1.5rem;">
  <h2>Seguridad inform치tica</h2>
  <form method="post" action="/technology/incidents/create">
    <div>
      <label>T칤tulo del incidente</label>
      <input type="text" name="title" placeholder="Intento de acceso no autorizado" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Severidad</label>
      <select name="severity">
        <option value="baja">Baja</option>
        <option value="media" selected>Media</option>
        <option value="alta">Alta</option>
        <option value="cr칤tica">Cr칤tica</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Estado</label>
      <select name="status">
        <option value="abierto">Abierto</option>
        <option value="investigando">Investigando</option>
        <option value="mitigado">Mitigado</option>
        <option value="cerrado">Cerrado</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Sistema afectado</label>
      <input type="text" name="impacted_system" placeholder="Servidor X, VPN, etc.">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Descripci칩n</label>
      <input type="text" name="description">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Registrar incidente</button>
  </form>

  <h3 style="margin-top:1rem;">Incidentes</h3>
  <table>
    <tr>
      <th>ID</th>
      <th>T칤tulo</th>
      <th>Severidad</th>
      <th>Estado</th>
      <th>Sistema</th>
      <th>Reportado por</th>
      <th>Detectado</th>
      <th>Acciones</th>
    </tr>
    {% for i in incidents %}
      <tr>
        <td>{{ i.id }}</td>
        <td>{{ i.title }}</td>
        <td>{{ i.severity }}</td>
        <td>{{ i.status }}</td>
        <td>{{ i.impacted_system or '' }}</td>
        <td>{{ i.reported_by }}</td>
        <td>{{ i.detected_at }}</td>
        <td>
          <form method="post" action="/technology/incidents/{{ i.id }}/change_status" style="display:inline;">
            <select name="new_status">
              <option value="abierto" {% if i.status == 'abierto' %}selected{% endif %}>Abierto</option>
              <option value="investigando" {% if i.status == 'investigando' %}selected{% endif %}>Investigando</option>
              <option value="mitigado" {% if i.status == 'mitigado' %}selected{% endif %}>Mitigado</option>
              <option value="cerrado" {% if i.status == 'cerrado' %}selected{% endif %}>Cerrado</option>
            </select>
            <button type="submit">Cambiar</button>
          </form>
          <form method="post"
                action="/technology/incidents/{{ i.id }}/delete"
                style="display:inline;"
                onsubmit="return confirm('쮼liminar este incidente?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not incidents %}
      <tr><td colspan="8">No hay incidentes registrados.</td></tr>
    {% endif %}
  </table>
</section>

<!-- ================== Innovaci칩n & Estrategia ================== -->
<section style="margin-top:1.5rem;">
  <h2>Innovaci칩n &amp; estrategia</h2>
  <form method="post" action="/technology/ideas/create">
    <div>
      <label>T칤tulo de la idea</label>
      <input type="text" name="title" placeholder="Nuevo m칩dulo de IA para CareWave" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Descripci칩n</label>
      <input type="text" name="description">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Estado</label>
      <select name="status">
        <option value="propuesta">Propuesta</option>
        <option value="en an치lisis">En an치lisis</option>
        <option value="aprobada">Aprobada</option>
        <option value="en marcha">En marcha</option>
        <option value="descartada">Descartada</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Impacto (1-10)</label>
      <input type="number" name="impact_score" min="1" max="10">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Esfuerzo (1-10)</label>
      <input type="number" name="effort_score" min="1" max="10">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Registrar idea</button>
  </form>

  <h3 style="margin-top:1rem;">Ideas</h3>
  <table>
    <tr>
      <th>T칤tulo</th>
      <th>Estado</th>
      <th>Impacto</th>
      <th>Esfuerzo</th>
      <th>Autor</th>
      <th>Creada</th>
      <th>Acciones</th>
    </tr>
    {% for idea in ideas %}
      <tr>
        <td>{{ idea.title }}</td>
        <td>{{ idea.status }}</td>
        <td>{{ idea.impact_score or '' }}</td>
        <td>{{ idea.effort_score or '' }}</td>
        <td>{{ idea.created_by }}</td>
        <td>{{ idea.created_at }}</td>
        <td>
          <form method="post"
                action="/technology/ideas/{{ idea.id }}/delete"
                onsubmit="return confirm('쮼liminar esta idea?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not ideas %}
      <tr><td colspan="7">No hay ideas registradas.</td></tr>
    {% endif %}
  </table>
</section>

<!-- ================== Dataset & Code cr칤tico ================== -->
<section style="margin-top:1.5rem;">
  <h2>Dataset &amp; Code cr칤tico</h2>
  <p>Aqu칤 puedes catalogar datasets sensibles, repositorios de c칩digo y scripts cr칤ticos.</p>

  <form method="post" action="/technology/assets/create">
    <div>
      <label>Nombre del activo</label>
      <input type="text" name="name" placeholder="Dataset pacientes cardiolog칤a" required>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Tipo</label>
      <select name="asset_type">
        <option value="dataset">Dataset</option>
        <option value="code">C칩digo / repositorio</option>
        <option value="script">Script cr칤tico</option>
        <option value="infra">Infraestructura / pipeline</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Clasificaci칩n</label>
      <select name="classification">
        <option value="baja">Confidencialidad baja</option>
        <option value="media">Confidencialidad media</option>
        <option value="alta" selected>Confidencialidad alta</option>
      </select>
    </div>
    <div style="margin-top:0.5rem;">
      <label>Ubicaci칩n t칠cnica</label>
      <input type="text" name="location" placeholder="Ruta servidor / bucket S3 / carpeta cifrada">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Repositorio / enlace</label>
      <input type="text" name="repo_url" placeholder="URL Git, carpeta compartida, etc.">
    </div>
    <div style="margin-top:0.5rem;">
      <label>Notas</label>
      <input type="text" name="notes" placeholder="Clave de cifrado en gestor de contrase침as, uso permitido, etc.">
    </div>
    <button type="submit" style="margin-top:0.8rem;">Registrar activo</button>
  </form>

  <h3 style="margin-top:1rem;">Activos registrados</h3>
  <table>
    <tr>
      <th>Nombre</th>
      <th>Tipo</th>
      <th>Clasificaci칩n</th>
      <th>Ubicaci칩n</th>
      <th>Repositorio / enlace</th>
      <th>Notas</th>
      <th>Acciones</th>
    </tr>
    {% for a in assets %}
      <tr>
        <td>{{ a.name }}</td>
        <td>{{ a.asset_type }}</td>
        <td>{{ a.classification }}</td>
        <td>{{ a.location or '' }}</td>
        <td>{{ a.repo_url or '' }}</td>
        <td>{{ a.notes or '' }}</td>
        <td>
          <form method="post"
                action="/technology/assets/{{ a.id }}/delete"
                onsubmit="return confirm('쮼liminar este activo cr칤tico?');">
            <button type="submit">Borrar</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not assets %}
      <tr><td colspan="7">No hay activos registrados todav칤a.</td></tr>
    {% endif %}
  </table>
</section>

{% endblock %} 
